---
task: m-improve-graphs-ux
branch: feature/improve-graphs-ux
status: pending
created: 2025-09-18
modules: [components/charts, components/ExpensesOverview]
---

# Improve UX in Graphs (Bar Chart and Pie Chart)

## Problem/Goal

Need to improve UX in graphs (bar chart and pie chart). Manual test, add feedback and prevent bad UX coming from webview (like selecting text elements), add press or long press behaviour if it makes sense. Check how it was before the latest library changes to highcharts.

## Success Criteria

- [ ] Manual test current graph UX issues
- [ ] Prevent text selection and other webview bad UX
- [ ] Add appropriate press/longpress interactions where beneficial
- [ ] Compare with previous implementation before Highcharts changes
- [ ] Implement haptic feedback for chart interactions
- [ ] Test chart responsiveness and touch handling
- [ ] Ensure consistent UX across bar and pie charts

## Context Manifest

### How WebView Charts Currently Work: Touch Interaction and UX Issues

The TravelCost app uses a sophisticated WebView-based Highcharts implementation for data visualization, which replaced the previous Victory charts system. The current architecture works as follows:

When a user views charts in the expenses overview, the system renders Highcharts through `WebViewChart.tsx:24-160`, which creates a complete HTML document containing Highcharts JavaScript and injects it into a React Native WebView. The WebView component is configured with specific settings to prevent typical mobile browser behaviors: `scrollEnabled={false}`, `bounces={false}`, and `scalesPageToFit={Platform.OS === "android"}` to ensure chart-specific interactions.

The HTML template generated by `generateHTMLTemplate` in `chartHelpers.ts:22-193` includes a basic CSS reset (`* { margin: 0; padding: 0; box-sizing: border-box; }`) and prevents Highcharts credits display, but **crucially lacks CSS properties to prevent text selection and other unwanted WebView behaviors**. This is the root cause of the reported UX issues where users can select text elements within the chart.

Chart interactions are handled through bidirectional communication: React Native sends data updates via `injectJavaScript()` while the WebView posts messages back using `window.ReactNativeWebView.postMessage()`. The current interaction system in `WebViewChart.tsx:72-116` handles three message types: "chart-ready", "point-click", and "zoom". However, the click interaction implementation has a timing-based approach using `setTimeout` for long press detection (500ms delay), which may not provide optimal UX compared to native touch handling.

The backup file `ExpenseChart.tsx.backup` shows the previous implementation included comprehensive haptic feedback (`Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light)` for clicks and `Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success)` for long press) and toast notifications with budget status information. The current `ExpenseChart.tsx:29-138` **lacks these interaction handlers entirely** - it only renders the chart without `onPointClick` or `onPointLongPress` callbacks, which means users get no feedback when interacting with chart elements.

Data processing flows through `ChartController` static methods which transform expense data with budget comparisons, applying color coding (green for under budget, red for over budget, gray for no expenses). The processed data is formatted for Highcharts using helper functions that create either column chart data (`createBarChartData`) or pie chart data (`createPieChartData`). This data structure preserves the original expense data in an `originalData` property, which was used in the previous implementation for navigation and budget calculations.

### For UX Improvements: What Needs to Connect

Since we're implementing chart UX improvements, we need to address several integration points that were lost during the Highcharts migration:

The text selection issue requires modifying the HTML template in `chartHelpers.ts` to include CSS properties like `user-select: none`, `-webkit-user-select: none`, and `-webkit-touch-callout: none` to prevent text selection and context menus. Additionally, we may need to prevent default touch behaviors on chart elements through JavaScript event handling.

The WebView configuration in `WebViewChart.tsx:139-157` already prevents scrolling and bouncing, but we may need additional properties to improve touch handling. The app uses patterns like `mediaPlaybackRequiresUserAction={false}` and `allowsInlineMediaPlayback={true}` which suggest the WebView is configured for interactive content.

The haptic feedback system is extensively used throughout the app with consistent patterns: `Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light)` for regular interactions and `Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success)` for significant actions like navigation. The `ExpenseChart` component needs to restore the `onPointClick` and `onPointLongPress` handlers that were in the backup implementation.

For budget status feedback, the previous implementation used React Native Toast Messages (`react-native-toast-message`) with localized strings from the i18n system. The budget calculation logic still exists in `ChartController.calculateBudgetStatus:122-139` but is no longer being called from the chart interactions.

Navigation integration requires the `navigation` prop to be passed through to `ExpenseChart` (currently missing from the component interface) to enable the long-press drill-down to `FilteredPieCharts` screen, which shows category breakdowns for specific time periods.

The chart sizing system uses `ChartController.getChartDimensions:173-184` which calculates responsive dimensions based on orientation context. This ensures charts adapt properly to portrait/landscape modes, but any UX improvements must maintain this responsive behavior.

The color system from `GlobalStyles.colors` provides consistent theming with specific colors for budget states (primary500 for normal, error300 for over budget, gray300 for no data). These colors are already integrated into the data processing pipeline but need to be preserved in any interaction improvements.

### Technical Reference Details

#### Missing Interaction Handlers

```typescript
// Need to restore these in ExpenseChart.tsx
onPointClick?: (data: any) => void;
onPointLongPress?: (data: any) => void;

// With haptic feedback patterns:
Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);        // For clicks
Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success); // For long press
```

#### CSS Fixes for Text Selection (chartHelpers.ts:34-57)

```css
* {
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
}
```

#### WebView Message Types (WebViewChart.tsx:17-22)

- chart-ready: WebView initialization complete
- point-click: User tapped chart element
- zoom: Chart zoom/pan events (currently unused)

#### Budget Calculation Interface

```typescript
ChartController.calculateBudgetStatus(
  expensesSum: number,
  budget: number,
  currency: string
): { isOverBudget: boolean; difference: number; message: string }
```

#### Navigation Pattern

```typescript
navigation.navigate("FilteredPieCharts", {
  expenses: filteredExpenses,
  dayString: datum.label,
});
```

#### Component Integration Points

- ExpenseChart: Column charts for expense timeline (needs interaction restoration)
- CategoryChart: Pie charts for category breakdown (read-only, no interactions needed)
- WebViewChart: Core chart component (needs CSS and touch improvements)
- ChartController: Data processing utilities (budget calculations exist but unused)

#### File Locations

- Main implementation: `/components/charts/WebViewChart.tsx`
- HTML template fixes: `/components/charts/chartHelpers.ts`
- Interaction restoration: `/components/ExpensesOverview/ExpenseChart.tsx`
- Chart usage: `/components/ExpensesOverview/CategoryChart.tsx`
- Previous implementation reference: `/components/ExpensesOverview/ExpenseChart.tsx.backup`

## Context Files

<!-- Added by context-gathering agent or manually -->

## User Notes

Improve UX in graphs (bar chart and pie chart), manual test, add feedback and prevent bad UX coming from webview (like selecting text elements), add press or long press behaviour if it makes sense (check how it was before the latest library changes to highcharts).

## Work Log

- [2025-09-18] Created task
